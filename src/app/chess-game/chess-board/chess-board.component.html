<div
    class="w-full h-full aspect-square mx-auto grid gap-0"
    [class.grid-cols-[5%_90%_5%]]="false"
    [class.grid-rows-[5%_90%_5%]]="false"
    [class.grid-cols-[0%_100%_0%]]="true"
    [class.grid-rows-[0%_100%_0%]]="true"
    [class.sm:grid-cols-[5%_90%_5%]]="true"
    [class.sm:grid-rows-[5%_90%_5%]]="true">
    <!-- Coordenadas superiores (letras a-h) - Ocultas en móvil -->
    <div class="col-start-2 row-start-1 hidden sm:grid sm:grid-cols-8 justify-items-center items-center text-sm font-semibold">
        @for (col of columns; track col) {
        <div class="flex justify-center items-center text-center h-full w-full" [style.gridColumn]="$index+1">{{ col }}
        </div>
        }
    </div>
    <!-- Coordenadas izquierdas (números 8-1) - Ocultas en móvil -->
    <div class="col-start-1 row-start-2 hidden sm:grid sm:grid-rows-8 items-center justify-items-center text-sm font-semibold">
        @for (row of rows; track row) {
        <div class="flex justify-center items-center text-center h-full w-full" [style.gridRow]="$index+1">{{
            row }}</div>
        }
    </div>
    <!-- Tablero principal -->
    <div class="col-start-2 row-start-2 grid grid-cols-8 grid-rows-8 aspect-square border-2 border-gray-700 shadow-lg relative w-full h-full"
        cdkDropListGroup>
        @for (row of board(); track $index) {
        @let rowIndex = $index;
        @for (square of row; track square.position) {
        @let colIndex = $index;
        <div class="chess-square-container aspect-square w-full h-full relative flex justify-center items-center box-border"
            [class.animate-entry]="animate()"
            [style.--i]="rowIndex * 8 + colIndex"
            cdkDropList [cdkDropListData]="square" [id]="'drop-' + square.position"
            (cdkDropListDropped)="onPieceDrop($event)" (cdkDropListEntered)="onSquareDragEnter(square)"
            (cdkDropListExited)="onSquareDragLeave(square)" [ngClass]="{
                                'bg-yellow-100': square.color === SquareColor.Light,
                                'bg-gray-700': square.color === SquareColor.Dark,
                                'ring-4 ring-inset ring-green-500': hoveredSquare() === square.position && lastMoveValid() === true,
                                'ring-4 ring-inset ring-red-500': hoveredSquare() === square.position && lastMoveValid() === false
                        }">
            <div class="w-full h-full relative transition-colors duration-200 flex justify-center items-center">
                <!-- Piezas que no se pueden arrastrar (turno incorrecto o juego terminado) -->
                @if (square.piece && (square.piece.color !== currentTurn() || gameOver()) && dragging() !==
                square.position) {
                <div class="piece-container w-full h-full flex justify-center items-center">
                    <app-chess-piece [piece]="square.piece"></app-chess-piece>
                </div>
                }
                <!-- Piezas del turno actual que se pueden arrastrar -->
                @if (square.piece && square.piece.color === currentTurn() && !gameOver()) {
                <div cdkDrag (cdkDragStarted)="onDragStarted(square)" (cdkDragEnded)="onDragEnded()"
                    class="flex justify-center items-center w-full h-full cursor-grab z-10 active:cursor-grabbing">
                    <div class="w-full h-full flex justify-center items-center">
                        <app-chess-piece [piece]="square.piece" [isMoving]="dragging() === square.position"></app-chess-piece>
                    </div>
                    <!-- Preview de la pieza arrastrada: centrado respecto al cursor -->
                    <ng-template cdkDragPreview>
                        <div class="flex items-center justify-center w-16 h-16 transform -translate-x-8 -translate-y-8">
                            <app-chess-piece [piece]="square.piece"></app-chess-piece>
                        </div>
                    </ng-template>
                </div>
                }
            </div>
        </div>
        }
        }
    </div>

    <!-- Coordenadas derechas - Ocultas en móvil -->
    <div class="col-start-3 row-start-2 hidden sm:grid sm:grid-rows-8 items-center justify-items-center text-sm font-semibold">
        @for (row of rows; track row) {
        <div class="flex justify-center items-center text-center h-full w-full"
            [style.gridRow]="$index+1">{{ row }}</div>
        }
    </div>

    <!-- Coordenadas inferiores - Ocultas en móvil -->
    <div class="col-start-2 row-start-3 hidden sm:grid sm:grid-cols-8 justify-items-center items-center text-sm font-semibold">
        @for (col of columns; track col) {
        <div class="flex justify-center items-center text-center h-full w-full"
            [style.gridColumn]="$index+1">{{ col }}
        </div>
        }
    </div>

</div>